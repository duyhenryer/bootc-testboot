# =============================================================================
# Base Image: CentOS Stream 10 bootc
# Layer 1: OS packages + production tuning (shared configs)
# =============================================================================
FROM quay.io/centos-bootc/centos-bootc:stream10

# --- System packages ---
RUN dnf install -y epel-release \
    && dnf install -y \
        htop curl jq lsof tcpdump sysstat vim-minimal \
        cloud-init openssh-server firewalld chrony \
    && dnf clean all \
    && rm -rf /var/cache/{dnf,ldconfig} /var/log/dnf*

# --- Production tuning (Rootfs Overlay) ---
COPY base/rootfs/ /
# --- Firewall base rules ---
RUN firewall-offline-cmd --zone=public --add-port=22/tcp

# --- Base user ---
RUN useradd -r -m -d /var/home/appuser -s /bin/bash appuser && \
    usermod -aG wheel appuser

# --- Enable base services ---
RUN systemctl enable cloud-init sshd firewalld chronyd

# --- Validate ---
LABEL containers.bootc=1
